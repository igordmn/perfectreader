<html>
<head>
    <meta charset="utf-8">
    <style type="text/css">
        @keyframes example {
            0%   {background-color: red;}
            25%  {background-color: yellow;}
            50%  {background-color: blue;}
            100% {background-color: green;}
        }
    </style>
</head>
<body style="width:200px; text-align: justify; text-align-last: right">

<div style="position:fixed">
    <button onclick="showPreview()">showPreview</button>
    <button onclick="showNext()">showNext</button>
    <button onclick="selectCurrent()">selectCurrent</button>
    <button onclick="selectAll()">selectAll</button>
</div>

<script type="text/javascript" src="assets://pagebook/js/utils/require.js"></script>
<script type="text/javascript" src="assets://pagebook/js/utils/test.js"></script>

<script type="text/javascript">
    var TestUtils = require("utils/test");
    var runTest = TestUtils.runTest;
    var assertEquals = TestUtils.assertEquals;
</script>


<div id="testElements" style="padding-top:40px">

<div id="t2" style="border: 1px solid black;">
    <div id="t2d">
        00000<span id="t2s1">0000
        <br>1111111111111</span>
        <br>2222222222
        <br>3333333333
        <br><span id="t2s2" style="display:inline-block">4444444<span>aaa</span>44</span>
        <br>9999999999999
    </div>
</div>
<script type="text/javascript">
    document.getElementById("t2d").style.typoHiddenLinesTop = 2;
    document.getElementById("t2d").style.typoHiddenLinesBottom = 2;

    setTimeout(function() {
        document.getElementById("t2d").style.typoHiddenLinesTop = 3;
    }, 2000);

    setTimeout(function() {
        document.getElementById("t2d").style.typoHiddenLinesTop = 0;
    }, 4000);

    setTimeout(function() {
        document.getElementById("t2d").style.typoHiddenLinesTop = 0;
        document.getElementById("t2d").style.typoHiddenLinesBottom = 0;
    }, 6000);
</script>



<div id="t3" style="border: 1px solid black; margin-top:30px; line-height:30px; ">999999999999999999999 88888888888888888888888</div>
<script type="text/javascript">
    document.getElementById("t3").style.typoHiddenLinesTop = 1;
    document.getElementById("t3").style.typoHiddenLinesBottom = 0;
    document.getElementById("t3").insertBefore(document.createTextNode("777777777777777777 "), document.getElementById("t3").firstChild);
    setTimeout(function() {
         document.getElementById("t3").removeChild(document.getElementById("t3").firstChild);
    }, 3000);
</script>



<ol id="t43" style="border: 1px solid black; margin-top:30px; ">
    <li id="t43l">999999999999999999999 88888888888888888888888</li>
    <li>999999999999999999999 88888888888888888888888</li>
</ol>
<script type="text/javascript">
    document.getElementById("t43l").style.typoHiddenLinesTop = 1;
</script>

<div id="t4" style="margin-top:30px; line-height:0.5">
    AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
    BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
</div>
<script type="text/javascript">
    runTest("caretRangeFromPoint after hide", function() {
        var t4 = document.getElementById("t4");
        var y = t4.offsetTop;
        assertEquals('B', t4.firstChild.nodeValue[document.caretRangeFromPoint(10, y + 10).startOffset], "elementBeforeHide");
        t4.style.typoHiddenLinesBottom = 1;
        assertEquals('A', t4.firstChild.nodeValue[document.caretRangeFromPoint(10, y + 10).startOffset], "elementAfterHide");
    });
</script>


<div id="t5" style="border: 1px solid black; margin-top:30px">
    <div id="t5d1">
        <div id="t5d2" style="float:left; width:50px">000000 111111 22222 33333 44444 55555</div>
        8999999999999
        7888888888888
    </div>
    <p id="t5p">aaaaaaaaaaaaaaaaaaaa bbbbbbbbbbbbb ccccccccccccccc ddddddddddddddddddddddd eeeeeeeeeeeeeeeeeeeeeeeeee</p>
</div>
<script type="text/javascript">
    document.getElementById("t5d1").style.typoHiddenLinesTop = 1;
    document.getElementById("t5d1").style.typoHiddenLinesBottom = 0;
    document.getElementById("t5d2").style.typoHiddenLinesTop = 0;
    document.getElementById("t5d2").style.typoHiddenLinesBottom = 5;
    document.getElementById("t5p").style.typoHiddenLinesTop = 0;
    document.getElementById("t5p").style.typoHiddenLinesBottom = 1;
</script>



<div id="t16" style="border: 1px solid black; margin-top: 50px">
    111111111111111111111 222222222222222222222222
    <div id="t16d">44444444444444444444 5555555555555555555555555</div>
    88888888888888888888888 99999999999999999999999999
</div>
<script type="text/javascript">
    document.getElementById("t16").style.typoHiddenLinesTop = 0;
    document.getElementById("t16").style.typoHiddenLinesBottom = 3;
    document.getElementById("t16d").style.typoHiddenLinesTop = 1;
    document.getElementById("t16d").style.typoHiddenLinesBottom = 0;
</script>



<div id="t33" style="border: 1px solid black; margin-top: 50px">
    111111111111111111111 222222222222222222222222
    <div id="t33d" style="float:left">44444444444444444444 5555555555555555555555555</div>
    88888888888888888888888 99999999999999999999999999
</div>
<script type="text/javascript">
    document.getElementById("t33").style.typoHiddenLinesTop = 0;
    document.getElementById("t33").style.typoHiddenLinesBottom = 3;
    document.getElementById("t33d").style.typoHiddenLinesTop = 1;
    document.getElementById("t33d").style.typoHiddenLinesBottom = 0;
</script>



<p id="t17" style="border: 1px solid black; margin-top:30px; -webkit-column-count: 2; -webkit-column-gap: 40px; -webkit-column-rule: 1px solid lightgrey; padding: 15px;">
    00000000000000000 1111111111111111 222222222222 3333333333333333 44444444444444444 5555555555555555555 66666666666666666666 7777777777777777777777777
</p>
<script type="text/javascript">
    document.getElementById("t17").style.typoHiddenLinesTop = 2;
    document.getElementById("t17").style.typoHiddenLinesBottom = 2;
    setTimeout(function() {
        document.getElementById("t17").appendChild(document.createTextNode("999999999999999999999"));
    }, 3000);
</script>

<div id="t18" style="border: 1px solid black; margin-top:30px; line-height:30px; padding-bottom:300px">
    <div>
        <button onclick="test1(); this.disabled = true;">test1</button>
        <button onclick="test2(); this.disabled = true;">test2</button>
        <button onclick="test3(); this.disabled = true;">test3</button>
        <button onclick="test4(); this.disabled = true;">test4</button>
    </div>
    <div>
        <button onclick="test5(); this.disabled = true;">test5</button>
        <button onclick="test6(); this.disabled = true;">test6</button>
        <button onclick="test7(); this.disabled = true;">test7</button>
        <button onclick="test8(); this.disabled = true;">test8</button>
    </div>
    <div id="t18d">
        11<img id="t18i" style="width:100px; height: 100px; vertical-align: middle"/>111
        2222222222222222222222222
        3333333333333333333333333
        4444444444444
        5555555555555
        6666666666666
    </div>
</div>
<script type="text/javascript">
    var el = document.getElementById("t18d");
    var parent = el.parentNode;
    var nextSibling = el.nextSibling;

    var img = document.getElementById("t18i");
    var div = document.createElement("div");
    div.appendChild(document.createTextNode("aaaaaaaaaaaaaaaaaaaaaa"));

    el.style.typoHiddenLinesTop = 2;
    el.style.typoHiddenLinesBottom = 2;

    function test1() {
        el.insertBefore(document.createTextNode("000000000000000000000000"), el.firstChild);
    }

    function test2() {
        img.style.marginLeft = 30;
    }

    function test3() {
        el.insertBefore(div, img);
    }

    function test4() {
        el.firstChild.nodeValue = "bbbbbbbbbbbbbbbbbbbbbbbbb";
    }

    function test5() {
        el.removeChild(div);
    }

    function test6() {
        el.innerHTML = "ccccccccccccccccccccc gggggggggggggggggggggg jjjjjjjjjjjjjjjjjjjjjjjj kkkkkkkkkkkkkkkkkkkkk lllllllllllllllllllll aaaaaaaaaaaaaaaaaaa rrrrrrrrrrrrrrrr";
    }

    function test7() {
        el.style.webkitColumnCount = 2;
        el.style.webkitColumnGap = 40;
        el.style.webkitColumnRule = "1px solid lightgrey";
    }

    function test8() {
        parent.removeChild(el);
        document.body.clientWidth;
        parent.insertBefore(el, nextSibling);
    }
</script>

<script type="text/javascript">
    var rootElements = [];
    var currentIndex = 0;

    var testElementsNode = document.getElementById("testElements");
    for (var i in testElementsNode.childNodes) {
        var node = testElementsNode.childNodes[i];
        if (node.nodeType == Node.ELEMENT_NODE && node.nodeName != "SCRIPT") {
            rootElements.push(node);
        }
    }
    function showPreview() {
        currentIndex > 0 && currentIndex--;
        showCurrent();
    }

    function showNext() {
        currentIndex < rootElements.length - 1 && currentIndex++;
        showCurrent();
    }


    function showCurrent() {
        window.scrollTo(0, rootElements[currentIndex].offsetTop - 40);
    }

    function selectCurrent() {
        getSelection().selectAllChildren(rootElements[currentIndex]);
    }

    function selectAll() {
        getSelection().selectAllChildren(document.getElementById("testElements"));
    }
</script>

</div>

</body>
</html>