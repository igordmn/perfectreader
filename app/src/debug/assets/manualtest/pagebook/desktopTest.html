<?xml version="1.0" encoding="UTF-8"?>

<!--
install https://www.npmjs.com/package/http-server
in project root folder perform: http-server -c
go in browser http://localhost:8080/app/src/debug/assets/manualtest/pageBook/desktopTest.html
-->

<html>
<head>
    <meta HTTP-EQUIV="content-type" CONTENT="text/html; charset=UTF-8"/>
    <style type="text/css">
        body {
            background-color: #EEEEEE;
        }

        #reader {
            border: 0;
            background-color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -400px;
            margin-left: -240px;
            width: 480px;
            height: 800px;
        }â€‹
    </style>
</head>
<body>
<script type="text/javascript" src="../../../../main/assets/pageBook/utils/string.js"></script>
<script type="text/javascript">

var segmentUrls = [
    absolutePath("../testBooks/extracted/carrollAliceInWonderland/wrap0000.html"),
    absolutePath("../testBooks/extracted/carrollAliceInWonderland/@public@vhost@g@gutenberg@html@files@28885@28885-h@28885-h-0.htm.html"),
    absolutePath("../testBooks/extracted/carrollAliceInWonderland/@public@vhost@g@gutenberg@html@files@28885@28885-h@28885-h-1.htm.html"),
    absolutePath("../testBooks/extracted/carrollAliceInWonderland/@public@vhost@g@gutenberg@html@files@28885@28885-h@28885-h-2.htm.html"),
    absolutePath("../testBooks/extracted/carrollAliceInWonderland/@public@vhost@g@gutenberg@html@files@28885@28885-h@28885-h-3.htm.html"),
    absolutePath("../testBooks/extracted/carrollAliceInWonderland/@public@vhost@g@gutenberg@html@files@28885@28885-h@28885-h-4.htm.html"),
    absolutePath("../testBooks/extracted/carrollAliceInWonderland/@public@vhost@g@gutenberg@html@files@28885@28885-h@28885-h-5.htm.html"),
    absolutePath("../testBooks/extracted/carrollAliceInWonderland/@public@vhost@g@gutenberg@html@files@28885@28885-h@28885-h-6.htm.html"),
    absolutePath("../testBooks/extracted/carrollAliceInWonderland/@public@vhost@g@gutenberg@html@files@28885@28885-h@28885-h-7.htm.html"),
    absolutePath("../testBooks/extracted/carrollAliceInWonderland/@public@vhost@g@gutenberg@html@files@28885@28885-h@28885-h-8.htm.html"),
    absolutePath("../testBooks/extracted/carrollAliceInWonderland/@public@vhost@g@gutenberg@html@files@28885@28885-h@28885-h-9.htm.html"),
    absolutePath("../testBooks/extracted/carrollAliceInWonderland/@public@vhost@g@gutenberg@html@files@28885@28885-h@28885-h-10.htm.html"),
    absolutePath("../testBooks/extracted/carrollAliceInWonderland/@public@vhost@g@gutenberg@html@files@28885@28885-h@28885-h-11.htm.html"),
    absolutePath("../testBooks/extracted/carrollAliceInWonderland/@public@vhost@g@gutenberg@html@files@28885@28885-h@28885-h-12.htm.html")
];

function onReaderLoad() {
    window.reader = document.getElementById("reader").contentWindow.reader;

    reader.setClient({
        percentToPage: function(pageCount, percent) {
            return Math.min(Math.round(percent * pageCount), pageCount - 1);
        },

        notifyPageCounts: function(previewSegment, currentSegment, nextSegment) {
            console.log("pageCounts: {0} {1} {2}".format(previewSegment, currentSegment, nextSegment));
        },

        handleTap: function() {
            console.log("tap");
        }
    });

    // on desktop configure must be called before book is loaded, because pageCount will not be updated
    reader.configure({
        pageWidth: document.getElementById("reader").clientWidth,
        pageHeight: document.getElementById("reader").clientHeight,
        fontSizePercents: 150,
    });

    reader.load(segmentUrls);

    document.getElementById("segmentIndex").max = segmentUrls.length - 1;
    document.getElementById("segmentIndex").value = 1;
    document.getElementById("segmentPercent").value = 0.5;
    goCurrentLocation();
}

function goCurrentLocation() {
    if (window.reader) {
        var segmentIndex = parseInt(document.getElementById("segmentIndex").value);
        var segmentPercent = parseFloat(document.getElementById("segmentPercent").value);
        window.reader.goLocation(segmentIndex, segmentPercent);
    }
}

function absolutePath(href) {
    var link = document.createElement("a");
    link.href = href;
    return link.protocol + "//" + link.host + link.pathname + link.search + link.hash;
}

</script>

<input id="segmentIndex" type="range" min="0" max="0" style="width:100%" onchange="goCurrentLocation()"/>
<input id="segmentPercent" type="range" min="0" max="1.0" step="0.01" style="width:100%" onchange="goCurrentLocation()"/>
<iframe id="reader" src="../../../../main/assets/pageBook/pageBook.html" onload="onReaderLoad()"></iframe>


</body>
</html>