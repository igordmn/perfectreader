<?xml version="1.0" encoding="UTF-8"?>
<html>
<head>
    <meta HTTP-EQUIV="content-type" CONTENT="text/html; charset=UTF-8"/>
</head>
<body style="margin:0;padding:0; font-size: 25%; overflow: hidden;">

<script type="text/javascript">console.log("ddd finish");</script>

<script type="text/javascript" src="js/dom.js"></script>
<script type="text/javascript" src="js/set.js"></script>
<script type="text/javascript" src="js/text.js"></script>

<script type="text/javascript">
    console.log("DDD end init");

    var html =
        "<style>\n" +
        "    @-webkit-keyframes foo {\n" +
        "        from { border:2px solid black; }\n" +
        "        to { border:4px solid black; }\n" +
        "    }\n" +
        "\n" +
        "    .qqqq {\n" +
        "        width:50px;\n" +
        "        height:50px;\n" +
        "        border-style:solid; /* If you remove this, it won't work! */\n" +
        "        -moz-animation:1s foo infinite alternate;\n" +
        "        -ms-animation:1s foo infinite alternate;\n" +
        "        -webkit-animation:1s foo infinite alternate;\n" +
        "    }\n" +
        "</style>" +

        "<link rel=\"stylesheet\" href=\"assets://manualtest/typoweb/style/style1.css\" type=\"text/css\"/>\n"+
        "<p id = \"testICU\"></p>" +
        "<p style=\"text-rendering: optimizeLegibility; -webkit-text-rendering: optimizeLegibility;\">AVAVAVAVAVAVAVAVAVAVAVAVAVAVAV</p>" +
        "<p>AVAVAVAVAVAVAVAVAVAVAVAVAVAVAV</p>" +
        "<p style=\"text-rendering: optimizeLegibility; -webkit-text-rendering: optimizeLegibility;\">ГоГоГоГоГоГоГоГоГоГоГоГоГоГоГо</p>" +
        "<p>ГоГоГоГоГоГоГоГоГоГоГоГоГоГоГо</p>" +
        "<input type=\"button\" onclick=\"console.log('button');\" value=\"button\" style=\"height:40;width:80\"\>" +
        "<div onclick=\"console.log('div');\" style=\"font-size:600%;height:40;width:80;border:1\">div</div>" +
        "<p><a style=\"font-size:17\" href=\"about:blank\">link</a></p><p><p>" +
        "<p style=\"border: 25px solid #feb515;-webkit-border-image: url(assets://manualtest/typoweb/img/border1.png) 100 round stretch; -webkit-border-radius: 15px; width: 50px; height: 20px;\">string</p>" +
        "<video src=\"media/video1.mp4\" style=\"height:75px; overflow: hidden; -webkit-border-radius: 110px; transform:rotate(5deg);\" autobuffer controls></video>" +
        "<audio controls autoplay><source src=\"media/audio.mp3\"/></audio>" +
        "<p><textarea name=\"comment\" cols=\"40\" rows=\"2\"></textarea></p>"+
        "<p><input type=\"date\" name=\"created\"></p>"+
        "<p><select><option>Пункт 1</option><option>Пункт 2</option></select></p>"+
        "<p id=\"qqqq\"></p>" +
        "<img src=\"assets://manualtest/typoweb/img/img1.jpg\"></img>" +
        "<img src=\"https://crosswalk-project.org/assets/identity/crosswalkproject-logo-horizontal-dark.png\"></img>" +
        "<img src=\"data:image/gif;base64,R0lGODlhPQBEAPeoAJosM//AwO/AwHVYZ/z595kzAP/s7P+goOXMv8+fhw/v739/f+8P" +
        "    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" +
        "4v/wRoRKQWGRHgrhGSQJxCS+0pCZbEhAAOw%3D%3D\">" +
        "<canvas id=\"canvas2d\" width=\"100\" height=\"50\"></canvas>" +
        "<canvas id=\"canvas3d\" width=\"50\" height=\"50\"></canvas>" +
        "<div class=\"title2\">Глава восьмая   </div>" +
        "<fdsf class=\"p\"><span lang=\"ar\">اللغة العربيةاللغة العربيةاللغة العربيةاللغة العربيةاللغة العربيةاللغة العاللغة االلغة االلغة االلغة االلغة االلغة االلغة االلغة االلغة االلغة االلغة االلغة االلغة االلغة اربية</span></fdsf>\n"+
        "<p>   Его звали Гаал Дорник, и был он всего-навсего обычным юношей, который до сих пор никогда не посещал Трантор, но, конечно, много раз видел эту планету по гипервидению и изредка в гигантских трехмерных газетных репортажах о коронации императора или открытии Галактического Совета. И хотя всю свою жизнь Дорник провел на планете Синнакс, расположенной в созвездии Голубой Туманности, он вовсе не был оторван от цивилизации.\n"+
        "<p>   В то время Галактика насчитывала около 25 миллионов населенных планет, и все они составляли одну Империю с центром на Транторе. За последние полвека мощь Империи значительно возросла.\n"+
        "<p>   Для Гаала предстоящее путешествие вне всякого сомнения сулило блестящий поворот в его научной карьере. В космосе он бывал уже не раз, и полет сам по себе мало что для него значил. Правда, раньше путешествия Гаала не шли дальше спутника Синнакса, где он добывал необходимые данные по механике метеоритного скольжения, и по продолжительности были невелики — полмиллиона миль или полмиллиона световых лет.\n"+
        "<p>   Дорник лишь немного волновался перед прыжком через гиперкосмос — здесь совсем иные ощущения, чем при межпланетных путешествиях. Гиперскачок был и, по всей видимости, надолго останется единственным практическим способом полетов к звездам. В обычном пространстве скорость звездолетов не превышает скорости света (только эта часть давно уже забытых данных сохранилась со времен ушедшей зари человеческой истории), — а это значит, что даже от одной населенной звездной системы, до ее ближайшей соседки когда-то приходилось путешествовать долгие годы. Зато через гиперпространство — это недоступное человеческому пониманию явление, которое не является ни пространством, ни временем, ни энергией, — можно пролететь всю Галактику из конца в конец за считанные часы.\n"+
        "<p>   В ожидании первого прыжка Дорник почувствовал, как подкатывает к горлу тошнота. Но ничего не произошло, разве что появилось смутное ощущение внутреннего толчка, который кончился прежде, чем Гаал успел его зафиксировать. И это было все.\n"+
        "<p>   А затем остались лишь звездолет, большой и сверкающий, совершеннейшая продукция двенадцатитысячелетнего развития Империи, и он сам, Гаал Дорник, новоиспеченный доктор наук, получивший приглашение на Трантор от самого Хари Сэлдона. Молодому ученому предстояло принять участие в каком-то загадочном сэлдоновском проекте.\n"+
        "<p>   После разочарования, испытанного при гиперпрыжке, Гаал с нетерпением ждал, когда же наконец появится Трантор. Он ни на минуту не покидал комнаты общего обзора. В заданное время стальные покрышки иллюминаторов откатывались назад, и Гаал всматривался в звезды, наслаждаясь их россыпями, похожими на рой застывших на месте светлячков. Когда заслонки откатились в очередной раз, Дорник увидел примерно в пяти световых годах от звездолета газовое скопление, которое проскользнуло мимо иллюминатора, как выплеснутое молоко. На какой-то миг оно наполнило комнату обзора леденящим светом, исчезнув из вида после нового прыжка.\n"+
        "<p>   Сначала солнце Трантора показалось маленькой точкой, затерянной среди миллиардов других, — здесь, в центре Галактики, скопления звезд были густы. С каждым прыжком эта звездочка сияла все ярче и ярче, заслоняя собой остальные.\n"+
        "<p>   В комнате обзора появился один из офицеров корабля и объявил:\n"+
        "<p>   — Обсерватория будет закрыта все оставшееся время полета. Приготовьтесь к посадке.\n"+
        "<p>   — Может быть, вы все-таки позволите мне остаться? — просил Гаал. — Я бы очень хотел увидеть Трантор отсюда.\n"+
        "<p>   Улыбаясь, офицер посмотрел на него, и Гаал покраснел. Ему пришло в голову, что он говорит с провинциальным акцентом.\n"+
        "<p>   — Мы приземлимся на Транторе только утром, — сказал офицер.\n"+
        "<p>   — Но мне бы хотелось понаблюдать за планетой из космоса.\n"+
        "<p>   — К сожалению, это невозможно, молодой человек. Мы не на космической яхте и заходим на посадку с солнечной стороны. Ведь не захотите же вы ослепнуть, сгореть и получить смертельную дозу радиации одновременно, а?\n"+
        "<p>   Гаал повернулся и, не говоря ни слова, пошел прочь. Офицер окликнул его.\n"+
        "<p>   — Трантор из космоса похож на грязно-голубое пятно. Так что нечего жалеть. А когда вы будете на планете, купите себе билет на космическое турне. Это недорого стоит.\n"+
        "<p>   — Спасибо вам большое, — ответил Гаал, поворачиваясь к офицеру.\n"+
        "<p>   Получив отказ, Гаал почувствовал себя совсем маленьким — к его горлу внезапно подкатил ком. Он никогда не видел Трантора, но много знал о его необъятной мощи, поэтому не хотел оттягивать встречу с этим долгожданным зрелищем ни на минуту.\t \n"+
        "<p>   Звездолет приземлился в страшной сумятице: шумели кондиционеры, гудели тормозные двигатели, резали ухо мужские и женские голоса. Обслуживающий персонал готовил трапы, по которым пассажиры перебирались на особые разгрузочные платформы.\n"+
        "<p>   Гаал почувствовал легкий толчок и понял, что звездолет отключил двигатели. Теперь в течение нескольких минут гравитационное поле корабля будет уравновешиваться с гравитационным полем планеты. Тысячи пассажиров терпеливо ждали в дебаркационных помещениях. Наконец началась высадка.\n"+
        "<p>   У Гаала почти не было багажа. Он стоял на палубе, пока содержимое его чемодана быстро и со знанием дела разобрали и сложили вновь. Визу его тщательно обследовали и поставили штамп в паспорт. Сам Гаал не обратил на эти процедуры никакого внимания.\n"+
        "<p>   Это был Трантор! Воздух здесь казался чуть менее разреженным, гравитация чуть большей, чем на его родной планете Синнакс, но к этому легко будет привыкнуть. А вот привыкнет ли Дорник когда-нибудь к такой необъятности?!!\n"+
        "<p>   Огромное здание космопорта. Свод потолка почти неразличим. Противоположную стену тоже не просто было заметить — насколько хватало глаз, виднелись одни столы да люди за ними.\n"+
        "<p>   — Идите же, Дорник, — прогремел раздраженный голос одного из таможенников. Прежде чем назвать Гаала по фамилии, он открыл паспорт с визой.\n"+
        "<p>   — Но куда? — нерешительно спросил Гаал.\n"+
        "<p>   Таможенник ткнул пальцем в воздух.\n"+
        "<p>   — Стоянка такси направо и третий поворот налево.\n"+
        "<p>   Гаал отошел от стола и увидел, как прямо в воздухе из ничего формируется надпись: «Такси по всем направлениям».\n"+
        "<p>   Человек, возникший неизвестно откуда, подошел к столу, у которого только что находился Гаал Таможенник кивнул неизвестному, слегка наклонив голову. Человек ответил тем же и проследовал за Гаалом. Он приблизился как раз в тот момент, когда Гаал собирался назвать пункт своего следования. Гаал тяжело оперся о барьер. Небольшая вывеска гласила: «Супервизор». Человек, сидевший за этой вывеской, спросил, не поднимая головы:\n"+
        "<p>   — Куда?\n"+
        "<p>   Дорник не понимал, что даже секундная задержка была недопустима: сзади немедленно начала собираться очередь. Супервизор оторвался от своих бумаг и поднял голову.\n"+
        "<p>   — Так куда?\n"+
        "<p>   Денег у Гаала было немного, но оставалось перебиться только одну ночь, потом он уже устроится на работу. Дорник старался, чтобы голос его звучал бесстрастно:\n"+
        "<p>   — В хороший отель.\n"+
        "<p>   — На супервизора это не произвело никакого впечатления.\n"+
        "<p>   — Они все хорошие, в какой именно?\n"+
        "<p>   — В ближайший, — с отчаянием в голосе ответил Гаал.\n"+
        "<p>   Супервизор дотронулся до кнопки. Тонкая световая линия легла на пол, рассыпавшись разнообразными цветами и оттенками. В руке у Гаала оказалась слабо светящаяся карточка.\n"+
        "<p>   — С вас один-двенадцать, — сказал супервизор.\n"+
        "<p>   Гаал сунул руку в карман за мелочью. '\n"+
        "<p>   — Куда мне идти?\n"+
        "<p>   — За световой линией. Вот карточка. Она будет светиться, пока вы идете правильно.\n"+
        "<p>   Гаал расплатился и двинулся вперед. Сотни людей так же, как и он, шли по своим маршрутам, следя за светом карточек. Его собственная карточка внезапно погасла. Человек в сверкающей желто-голубой форме из сверхпрочного пластитек-столита поднял багаж Дорника.\n"+
        "<p>   — Прямая линия до Люксора, — сказал он.\n"+
        "<p>   Неизвестный, следовавший за Гаалом, все слышал, даже как тот, садясь в машину, ответил: «Хорошо».\n"+
        "<p>   Такси вертикально поднялось в воздух. Гаал смотрел в изогнутое прозрачное окно, наслаждаясь ощущением полета в машине и инстинктивно уцепившись за сидение водителя. Люди внизу стали походить на муравьев в растревоженном муравейнике. Затем они сделались невидимыми.\n"+
        "<p>   Впереди показалась стена. Она начиналась высоко в воздухе, а конца ее не было видно. В стене зияли широкие дыры туннелей. Такси подлетело к одной из этих дыр и нырнуло внутрь. На секунду Гаал удивился, как это водитель узнал, что нужно именно сюда. Темноту вокруг рассекали лишь одинокие сигнальные огни.\n"+
        "<p>   Таксист резко снизил скорость, и Гаал подался вперед, стараясь восстановить равновесие. Затем машина вынырнула из туннеля и затормозила на одном из уровней.\n"+
        "<p>   — Отель «Люксор», — сказал водитель.\n"+
        "<p>   Он помог Гаалу выгрузить багаж, с деловым видом получил десять кредиток на чай, взял очередного пассажира и тут же поднялся в воздух.\n"+
        "<p>   Урбанизация этой планеты достигла своего максимума. Вся поверхность Трантора протяженностью 75 ООО ООО кв. миль представляла собой один громадный город. Население превышало 40 миллиардов человек. Это огромное количество людей занималось исключительно административными нуждами планеты и Империи. Тем не менее их было недостаточно для решения многих насущных проблем. Каждый день целые флотилии, состоящие из десятков тысяч кораблей, привозили продукты с сельскохозяйственных планет на обеденные столы Трантора…\n"+
        "<p>   Зависимость планеты от внешних миров не только в сельскохозяйственной, но и в других областях, связанных с жизненной необходимостью, сделало Трантор исключительно уязвимым в случае нападения и долгой осады. За последнее десятилетия императоры хорошо поняли это, подавляя восстание за восстанием, и вся политика императорского двора свелась к тому, чтобы как-то защитить слабое место Империи…\n"+
        "<p>   В поисках билетной кассы Дорник наткнулся на дверь с короткой надписью «Солярий». В этой комнате, оказавшейся обычным помещением с искусственным солнечным светом, он задержался лишь на несколько минут, затем вернулся в главный холл «Люксора».\n"+
        "<p>   — Скажите, где я могу купить билет на космическое турне? — спросил Гаал у администратора.\n"+
        "<p>   — Здесь.\n"+
        "<p>   — А когда оно начинается?\n"+
        "<p>   — Оно уже началось, вы опоздали на несколько минут, но следующее турне завтра. Вы можете купить билет прямо сейчас, и мы зарегистрируем для вас место.\n"+
        "<p>   — Понятно.\n"+
        "<p>   Завтра будет поздно. С самого утра ему надо идти в Университет.\n"+
        "<p>   — Скажите, а у вас нет здесь чего-нибудь вроде наблюдательной вышки? — спросил Гаал. — На открытом воздухе?..\n"+
        "<p>   — Ну, конечно, есть! Если хотите, можете приобрести билет туда. Только сначала лучше проверить, не идет ли дождь.\n"+
        "<p>   Администратор двинул какой-то рычажок рядом со своим локтем и посмотрел на матовый экран, по которому заскользили цифры. Гаал с интересом наблюдал за его действиями.\n"+
        "<p>   — Хорошая погода, — сказал администратор. — Сам-то я не очень люблю выходить наружу, — добавил он доверительно. — Последний раз выходил года три назад. Один раз посмотришь, и сразу же все становится ясно… Вот ваш билет. Специальный лифт рядом с «черным ходом» отеля. На нем написано: «Башня». Садитесь в лифт, и всего вам доброго.\t \n"+
        "<p>   Лифт оказался новинкой: он поднимался, используя отрицательные и положительные гравитационные поля. Гаал вошел первым, остальные экскурсанты последовали за ним. Лифтер нажал на кнопку. На секунду, когда наступила невесомость, Гаалу показалось, что он опять в космосе. Но постепенно лифт набрал скорость, и все стало на свои места. Однако ненадолго. После резкого, правда, не очень чувствительного торможения ноги Гаала оторвались от пола, и он невольно вскрикнул.\n"+
        "<p>   — Засуньте ноги под скобы на полу, — проворчал лифтер. — Вы что, читать не умеете?\n"+
        "<p>   Все остальные поступили так с самого начала и сейчас, улыбаясь, смотрели на тщетные попытки Дорника спуститься на пол. Ботинки торчали из-под сверкающих хромом скоб, которые располагались на полу двумя параллельными рядами. Гаал увидел эти скобы, как только вошел в лифт, но не подумал об их назначении. Затем чья-то вытянутая рука потянула его вниз. Слегка задыхаясь, Дорник пробормотал слова благодарности. Тем временем лифт остановился.\n"+
        "<p>   Гаал вышел на открытый балкон, и слепящий свет больно ударил его по глазам. Человек, уверенная рука которого только что помогла ему, вышел следом.\n"+
        "<p>   — Здесь сколько угодно свободных мест, — сказал он покровительственно.\n"+
        "<p>   Гаал, все еще не отдышавшись, ответил:\n"+
        "<p>   — Да, мест более чем достаточно."
        ;

    setTimeout(function() {
        load();
    }, 10);

    function load() {
        var t1 = new Date().getTime();

        var win = document.getElementById("content").contentWindow;
        var doc = win.document;
        doc.open();
        doc.write(html);
        doc.close();

        var img = document.createElement('IMG');
        img.onload = function () {
            doc.getElementById("canvas2d").getContext("2d").drawImage(img, 0, 0);
        }
        img.src = "assets://manualtest/typoweb/img/img1.jpg";

        setTimeout(function() {
            doc.getElementById("canvas2d").getContext("2d").drawImage(doc.getElementById("vid"), 0, 0);
        }, 8000);

       // init3D(win);

        var loadTime = new Date().getTime() - t1;

        window.scrollTo(20, 0);

        doc.body.style.setProperty("-webkit-column-width", "240px", "important");
        doc.body.style.setProperty("width", "240px", "important");
        doc.body.style.setProperty("height", "400px", "important");
        doc.body.style.setProperty("font-size", "25%", "important");

        setTimeout(function() {
            doc.getElementById("qqqq").className="qqqq";
        }, 5000);

        var FORMAT_ELEMENTS = stringSet([
            "LABEL", "RUBY", "RT", "LI", "CAPTION", "TD", "TH", "INPUT", "BUTTON", "MARQUEE",
            "ARTICLE", "BLOCKQUOTE", "CENTER", "DT", "DD", "DETAILS", "DIV", "FIGCAPTION",
            "FOOTER", "H1", "H2", "H3", "H4", "H5", "H6", "HEADER", "LEGEND", "LISTING", "MAIN",
            "NAV", "OL", "OPTION", "P", "SECTION", "SUMMARY", "UL", "XMP"
        ]);

        var postActions = (function () {
            var firstActions = [];
            var secondActions = [];
            var thirdActions = [];

            return {
                pushFirst: function (func) {
                    firstActions.push(func);
                },

                pushSecond: function (func) {
                    secondActions.push(func);
                },

                pushThird: function (func) {
                    thirdActions.push(func);
                },

                execAll: function () {
                    firstActions.forEach(function (action) {
                        action();
                    });
                    secondActions.forEach(function (action) {
                        action();
                    });
                    thirdActions.forEach(function (action) {
                        action();
                    });
                    firstActions.length = 0;
                    secondActions.length = 0;
                    thirdActions.length = 0;
                }
            };
        })();

        var range = doc.createRange();

        iterateChildrenRecursively(doc.body, function (node) {
            if (node.nodeType == Node.ELEMENT_NODE && FORMAT_ELEMENTS.contains(node.nodeName)) {
                var text = elementText(node);
                text.find(
                        /[^ ][ ][^ ]/g,
                        function (result) {
                            result.range().insertNode(doc.createElement("br"));
                        }
                );
            }
        });

        postActions.execAll();

        doc.body.offsetHeight;

        var modifyTime = new Date().getTime() - (t1 + loadTime);

        console.log("DDD Full load time " + loadTime + "; Modify Time " + modifyTime);

        setTimeout(function() {
            doc.getElementById("testICU").innerHTML = getMsg();

            console.log("DDD value from java: " + javaBridge.valueFromJava("абв"));
            javaBridge.voidTest("один", "два");

            var n = 1000;
            var t1 = new Date().getTime();
            for (var i = 0; i < n; i++) {
                javaBridge.valueFromJava("абв");
            }
            var t2 = new Date().getTime();
            console.log("DDD value from java call time: " + (t2 - t1) / n);
        }, 500);

        var periodicLog = function() {
            console.log("DDD periodicLog");
            setTimeout(periodicLog, 2000);
        }
        setTimeout(periodicLog, 2000);
    }

    function getMsg() {
        var options = {
            weekday: "long", year: "numeric", month: "short",
            day: "numeric", hour: "2-digit", minute: "2-digit"
        };
        return new Date().toLocaleTimeString("ru-RU", options);
    }


    function init3D(win) {
        var canvas = win.document.getElementById("canvas3d");

        var gl = canvas.getContext("webgl");
        gl.viewport(0, 0, 100, 100);
        gl.clearColor(0, 1, 1, 1);
        gl.enable(gl.DEPTH_TEST);

        function getShader(type, text) {
            var shader = gl.createShader(type);
            gl.shaderSource(shader, text);
            gl.compileShader(shader);
            if( ! gl.getShaderParameter(shader, gl.COMPILE_STATUS) )
                throw gl.getShaderInfoLog(shader);
            return shader;
        }

        var vertexShader = "attribute vec3 vertexPosition;"+
                           "attribute vec2 textureCoord;"+
                           "uniform mat4 mvMatrix;"+
                           "uniform mat4 pMatrix;"+
                           "varying vec2 vTextureCoord;"+
                           "void main(void) {"+
                           "  gl_Position = pMatrix * mvMatrix * vec4(vertexPosition, 1.0);"+
                           "  vTextureCoord = textureCoord; }";

        var fragmentShader = "precision mediump float;"+
                             "varying vec2 vTextureCoord;"+
                             "uniform sampler2D sampler;"+
                             "void main(void) {"+
                             "  gl_FragColor = texture2D(sampler, vec2(vTextureCoord.s, vTextureCoord.t)); }";

        var shaderProgram = gl.createProgram();
        gl.attachShader(shaderProgram, getShader( gl.VERTEX_SHADER, vertexShader));
        gl.attachShader(shaderProgram, getShader( gl.FRAGMENT_SHADER, fragmentShader));
        gl.linkProgram(shaderProgram);

        gl.useProgram(shaderProgram);
        var vpLoc = gl.getAttribLocation(shaderProgram, "vertexPosition");
        gl.enableVertexAttribArray(vpLoc);
        var tcLoc = gl.getAttribLocation(shaderProgram, "textureCoord");
        gl.enableVertexAttribArray(tcLoc);

        var pmLoc   = gl.getUniformLocation(shaderProgram, "pMatrix");
        var mvLoc   = gl.getUniformLocation(shaderProgram, "mvMatrix");
        var sampler = gl.getUniformLocation(shaderProgram, "sampler");

        function getPerspectiveMatrix( fov, aspectRatio, near, far )	{
            var f = 1/Math.tan(fov * Math.PI / 360.0); // some divide fov by 2 instead.
            return new Float32Array([ f/aspectRatio, 0, 0, 0, 0, f, 0, 0, 0, 0, (near+far)/(near-far), -1, 0, 0, 2*near*far/(near-far), 0]);
        }
        var pMatrix = getPerspectiveMatrix( 45, canvas.clientWidth/canvas.clientHeight, 0.1, 1000);

        function pushVertices( obj, v, n) {
            for ( var i = 0; i<v.length; i++) {
                obj.v.push( 2*!(v[i]&1)-1, 2*!(v[i]&2)-1, 2*!(v[i]&4)-1 ); // vertices
                //obj.t.push( i&1?1:0, i&2?1:0 ); // uv mapping
                obj.n.push.apply( obj.n, n); // normals
            }
            obj.t.push( 0,0,1,0,1,1,0,1 ); // uv mapping
        }

        function getBox() {
            var obj = { v : [], n : [], t : [], i : []};
            var van = [ // vertices and normals
                [[0, 4, 6, 2], [-1, 0, 0]],
                [[1, 3, 7, 5], [+1, 0, 0]],
                [[0, 1, 5, 4], [0, -1, 0]],
                [[2, 6, 7, 3], [0, +1, 0]],
                [[0, 2, 3, 1], [0, 0, -1]],
                [[4, 5, 7, 6], [0, 0, +1]]
            ];
            for ( var i = 0; i<van.length; i++) {
                pushVertices( obj, van[i][0], van[i][1] );
                obj.i.push( 4*i+0, 4*i+1, 4*i+2, 4*i+0, 4*i+2, 4*i+3);
            }
            return obj;
        }
        var box = getBox();

        function createBuffer( target, type, data) {
            var b = gl.createBuffer();
            gl.bindBuffer( target, b);
            gl.bufferData( target, new type(data), gl.STATIC_DRAW);
            return b;
        }

        function setUpBuffers( obj) {
            obj.vb = createBuffer( gl.ARRAY_BUFFER, Float32Array, obj.v);
            obj.nb = createBuffer( gl.ARRAY_BUFFER, Float32Array, obj.n);
            obj.tb = createBuffer( gl.ARRAY_BUFFER, Float32Array, obj.t);
            obj.ib = createBuffer( gl.ELEMENT_ARRAY_BUFFER, Uint16Array, obj.i);
        }

        setUpBuffers( box);

        box.texture = gl.createTexture();
        var image = new Image();
        var ready = false;
        image.onload = function () {
            gl.bindTexture(gl.TEXTURE_2D, box.texture);
            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
            gl.bindTexture(gl.TEXTURE_2D, null);
            ready = true;
        }
        image.src= "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAABGdBTUEAALGPC/xhBQAAAA9QTFRFABEsAAobAAUQAC2SAAAAobC6MgAAAK1JREFUeNrt0jEBACAMxMAOSEACDooD8K8JXPxyUXBDqsPVvtEOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAWMNKAmQYsEwIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfECHewiS34IF3lURAAAAAElFTkSuQmCC";

        var mvMatrix = new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]); // identity
        mvMatrix[14]=-10;

        function rotate( mat, angle, x, y, z) {
            var s, c, t, a00, a01, a02, a03, a10, a11, a12, a13, a20, a21, a22, a23, b00, b01, b02, b10, b11, b12, b20, b21, b22;
            var len = Math.sqrt(x * x + y * y + z * z);
            x /= len; y /= len; z /= len;
            s = Math.sin(angle); c = Math.cos(angle); t = 1 - c;

            a00=mat[0];a01=mat[1];a02=mat[2];a03=mat[3];a10=mat[4];a11=mat[5];
            a12=mat[6];a13=mat[7];a20=mat[8];a21=mat[9];a22=mat[10];a23=mat[11];
            b00 = x * x * t + c;     b01 = y * x * t + z * s; b02 = z * x * t - y * s; // Construct the elements of the rotation matrix
            b10 = x * y * t - z * s; b11 = y * y * t + c;     b12 = z * y * t + x * s;
            b20 = x * z * t + y * s; b21 = y * z * t - x * s; b22 = z * z * t + c;

            // Perform rotation-specific matrix multiplication
            mat[0] = a00 * b00 + a10 * b01 + a20 * b02;        mat[1] = a01 * b00 + a11 * b01 + a21 * b02;
            mat[2] = a02 * b00 + a12 * b01 + a22 * b02;        mat[3] = a03 * b00 + a13 * b01 + a23 * b02;
            mat[4] = a00 * b10 + a10 * b11 + a20 * b12;        mat[5] = a01 * b10 + a11 * b11 + a21 * b12;
            mat[6] = a02 * b10 + a12 * b11 + a22 * b12;        mat[7] = a03 * b10 + a13 * b11 + a23 * b12;
            mat[8] = a00 * b20 + a10 * b21 + a20 * b22;        mat[9] = a01 * b20 + a11 * b21 + a21 * b22;
            mat[10] = a02 * b20 + a12 * b21 + a22 * b22;       mat[11] = a03 * b20 + a13 * b21 + a23 * b22;
        }

        function drawScene( obj) {
            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

            gl.uniformMatrix4fv( pmLoc, false, pMatrix);
            gl.uniformMatrix4fv( mvLoc, false, mvMatrix);

            gl.bindBuffer( gl.ARRAY_BUFFER, obj.vb);
            gl.vertexAttribPointer( vpLoc, 3, gl.FLOAT, false, 0, 0);

            gl.bindBuffer( gl.ARRAY_BUFFER, obj.tb);
            gl.vertexAttribPointer( tcLoc, 2, gl.FLOAT, false, 0, 0);

            gl.bindTexture( gl.TEXTURE_2D, obj.texture);
            gl.uniform1i( sampler, 0);

            gl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, obj.ib);
            gl.drawElements( gl.TRIANGLES, obj.i.length, gl.UNSIGNED_SHORT, 0);
        }

        var lastTime=0;
        function tick( timeNow) {
            var elapsed = timeNow - lastTime;
            lastTime = timeNow;
            if(isNaN(elapsed)) elapsed = 0;
            requestAnimationFrame(tick);
            if( ready) {
                drawScene(box);
                rotate( mvMatrix, elapsed/1000, 0.1,0.7,0.2);
            }
        }

        requestAnimationFrame(tick);

    }

    function onscrolltestLoad() {
        var scrollTestWindow = document.getElementById("scrolltest").contentWindow;
        console.log("DDD scrollHeight " +  scrollTestWindow.document.body.scrollHeight);
        console.log("DDD clientHeight " +  scrollTestWindow.document.body.clientHeight);
    }

    function calledFromJava() {
        console.log("DDD called from java");
    }
</script>
<iframe style="width: 250px; height: 40px" id="scrolltest" scrolling="no" onload="onscrolltestLoad()" src="data:text/html;charset=utf-8,%3C!DOCTYPE%20HTML%20PUBLIC%20%22-%2F%2FW3C%2F%2FDTD%20HTML%204.0%2F%2FEN%22%3E%0D%0A%3Chtml%20lang%3D%22en%22%3E%0D%0A%3Chead%3E%3Ctitle%3EEmbedded%20Window%3C%2Ftitle%3E%3C%2Fhead%3E%0D%0A%3Cbody%3E%3Cp%3E42АБВ%3C%2Fp%3E%3C%2Fbody%3E%0D%0A%3C%2Fhtml%3E%0D%0A"></iframe>
<iframe style="width: 1000px; height: 400px; border:0" id="content" scrolling='no'></iframe>
<iframe style="width: 250px; height: 350px" src="assets://manualtest/typoweb/frame1.html"></iframe>
<iframe style="width: 250px; height: 350px; position:absolute; left:250px" src="assets://manualtest/typoweb/frame3.html"></iframe>

</body>
</html>